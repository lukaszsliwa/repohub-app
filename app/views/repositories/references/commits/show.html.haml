= content_for :nav do
  = render partial: 'repositories/nav'

.full-commit
  %p.commit-title
    =# image_tag @commit.user.avatar.thumb, class: 'img-rounded', width: '32px'
    = image_tag 'avatar.png', class: 'img-rounded', width: '32px'
    = @commit.message
  .commit-meta
    .pull-left
      #{l @commit.created_at, format: :long}
    .pull-right
      #{pluralize @commit.parents.size, 'parent'}
      - @commit.parents.each do |parent|
        = link_to truncate(parent, length: 8, omission: ''), repository_reference_commit_path(reference_type: @reference.type.tableize, reference_id: @reference.name, id: parent)
      &nbsp;
      commit
      = link_to @commit.sha, repository_reference_commit_path(reference_type: @reference.type.tableize, reference_id: @reference.name, id: @commit.sha)
    .clearfix
  %ul.commit-files
    - @commit.files.each_with_index do |file, index|
      %li.commit-file(data-number="#{index}" id="commit-file-#{index}")
        .pull-left.commit-file-pointer
          - if file.status == :added
            %i.fa.fa-plus-square(style='color: green')
          - if file.status == :deleted
            %i.fa.fa-minus-square
          - if file.status == :modified
            %i.fa.fa-pencil-square(style='color: orange')
        .pull-left.commit-file-path
          = link_to file.path, repository_reference_commit_path(reference_type: @reference.type.tableize, reference_id: @reference.name, id: @commit.sha, anchor: "file-#{index}"), class: 'file-path', data: {number: index}, title: file.path
        %div(class="pull-right commit-file-info commit-info-#{index}")
        .clearfix

- @commit.files.each_with_index do |file, index|
  .file(data-number="#{index}" id="file-#{index}")
    .file-header
      %div(class="pull-left file-header-info")
        .pull-left.file-header-info-squares(data-additions="#{file.additions}" data-deletions="#{file.deletions}" class="file-header-info-squares-#{index}")
          - if (changes = file.additions + file.deletions) > 0
            - (file.additions * 7 / changes).round.times do
              .pull-left.file-header-info-square-addition
            - (7 - (file.additions * 7 / changes).round).times do
              .pull-left.file-header-info-square-deletion
          - else
            - 7.times do
              .pull-left.file-header-info-square-context
        .pull-left.file-header-info-changes= pluralize changes, 'change'
      .pull-left.file-header-path
        :javascript
          var path = $(".file-path[data-number='#{index}']").html();
          document.write('<a href="#{repository_reference_tree_path(reference_type: 'references', reference_id: @commit.sha)}/' + path + '" title="' + path + '">' + path + '</a>');
          $(function() {
            $('.file-header-info-squares-#{index}').clone().appendTo('.commit-info-#{index}');
          });
      .clearfix
    .diff-wrapper
      - file.lines.group_by(&:hunk_id).each do |hunk_id, lines|
        %table.diff-table(id="diff-#{hunk_id}")
          %tbody
          %tbody
            %tr
              %td.line.line-hunk
              %td.line.line-hunk
              %td.line.line-hunk
              %td.line.line-hunk
            - lines.each do |line|
              %tr
                %td(class="line line-#{line.status} line-number")= line.number unless line.status == 'addition'
                %td(class="line line-#{line.status} line-number")= line.number unless line.status == 'deletion'
                %td(class="line line-#{line.status} line-pointer")= line.status == 'addition' ? '+' : (line.status == 'deletion' ? '-': '')
                %td(class="line line-#{line.status} line-code")= line.content
